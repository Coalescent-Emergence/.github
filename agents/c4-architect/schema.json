{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/Coalescent-Emergence/.github/agents/c4-architect/schema.json",
  "title": "C4 Architect Output Schema",
  "description": "JSON schema for C4 Architect agent outputs",
  
  "definitions": {
    "BaseOutput": {
      "type": "object",
      "required": ["diagram_type", "mermaid_code", "confidence", "rationale"],
      "properties": {
        "diagram_type": {
          "type": "string",
          "enum": ["C4Context", "C4Container", "C4Component"]
        },
        "mermaid_code": {
          "type": "string",
          "description": "Valid Mermaid C4 diagram syntax"
        },
        "adr_needed": {
          "type": "boolean",
          "description": "Whether this architectural change requires an ADR"
        },
        "confidence": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        },
        "rationale": {
          "type": "string",
          "minLength": 20,
          "description": "Key architectural decisions and assumptions"
        }
      }
    },
    
    "ContextOutput": {
      "allOf": [
        { "$ref": "#/definitions/BaseOutput" },
        {
          "type": "object",
          "required": ["description", "key_relationships"],
          "properties": {
            "diagram_type": { "const": "C4Context" },
            "description": {
              "type": "string",
              "description": "Overview of system boundaries and purpose"
            },
            "key_relationships": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": ".+ (->|<-) .+ (via|using) .+"
              },
              "description": "Critical relationships in 'Source -> Target via Channel' format"
            }
          }
        }
      ]
    },
    
    "ContainerOutput": {
      "allOf": [
        { "$ref": "#/definitions/BaseOutput" },
        {
          "type": "object",
          "required": ["containers", "component_recommendations"],
          "properties": {
            "diagram_type": { "const": "C4Container" },
            "containers": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "repository", "technology", "responsibility"],
                "properties": {
                  "name": { "type": "string" },
                  "repository": { "type": "string" },
                  "technology": { "type": "string" },
                  "responsibility": { "type": "string" }
                }
              }
            },
            "component_recommendations": {
              "type": "array",
              "minItems": 3,
              "maxItems": 5,
              "items": {
                "type": "object",
                "required": ["name", "repository", "priority", "description"],
                "properties": {
                  "name": { "type": "string" },
                  "repository": { "type": "string" },
                  "priority": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 5,
                    "description": "1=highest priority"
                  },
                  "description": { "type": "string" },
                  "dependencies": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              }
            },
            "cross_repo_dependencies": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Dependencies between repositories"
            }
          }
        }
      ]
    },
    
    "ComponentOutput": {
      "allOf": [
        { "$ref": "#/definitions/BaseOutput" },
        {
          "type": "object",
          "required": ["components", "implementation_tasks"],
          "properties": {
            "diagram_type": { "const": "C4Component" },
            "components": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "type", "responsibility"],
                "properties": {
                  "name": { "type": "string" },
                  "type": {
                    "type": "string",
                    "enum": ["Package", "Service", "Module", "Handler", "Repository", "Middleware"]
                  },
                  "responsibility": { "type": "string" },
                  "dependencies": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              }
            },
            "implementation_tasks": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["component", "order", "description", "test_requirements"],
                "properties": {
                  "component": { "type": "string" },
                  "order": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "description": { "type": "string" },
                  "test_requirements": { "type": "string" }
                }
              }
            }
          }
        }
      ]
    }
  }
}
